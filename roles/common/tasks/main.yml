---

  - name: Disable SELinux
    selinux: state=disabled
    tags:
      - configuration

  - name: Disable Firewalld
    service: name=firewalld enabled=no state=stopped
    tags:
      - configuration

  - name: Install common packages
    yum: name={{ item }} state=present
    with_items:
      - unzip
      - ntp
      - wget
      - git
    tags:
      - configuration

  - name: Ensure ntpd is up
    service: name=ntpd enabled=yes state=started
    tags:
      - configuration

  - name: Configure ntp
    template: src=ntp.conf.j2 dest=/etc/ntp.conf
    notify: restart ntp
    tags:
      - configuration

  - name: restart machine
    shell: sleep 2 && shutdown -r now "Ansible updates triggered"
    async: 1
    poll: 0
    ignore_errors: true
    tags:
      - configuration

  - name: Waiting for server to come back
    local_action: wait_for host={{ inventory_hostname }} state=started delay=30 timeout=60
    tags:
      - configuration
