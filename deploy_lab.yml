---
  - hosts: nv-fabric1-apic1
    gather_facts: no

    vars:
      aci_login: &aci_login
        hostname: '{{ aci_hostname }}'
        username: '{{ aci_username }}'
        password: '{{ aci_password }}'
        validate_certs: no
        use_ssl: no
        use_proxy: no
      post_to_uni: &post_to_uni
        method: post
        path: /api/mo/uni.json

    tasks:
    - name: Deploy Communication Policy
      aci_rest:
        <<: *aci_login
        <<: *post_to_uni
        src: /home/nvermand/lab/fabric1/comm-default.json
      delegate_to: localhost
    - name: Deploy DNS Policy
      aci_rest:
        <<: *aci_login
        <<: *post_to_uni
        src: /home/nvermand/lab/fabric1/dnsp-default.json
      delegate_to: localhost
    - name: Deploy Date and Time Policy
      aci_rest:
        <<: *aci_login
        <<: *post_to_uni
        src: /home/nvermand/lab/fabric1/ntpprov-clock.cisco.com.json
      delegate_to: localhost
    - name: Deploy BGP Fabric Policy
      aci_rest:
        <<: *aci_login
        <<: *post_to_uni
        src: /home/nvermand/lab/fabric1/bgpInstP-default.json
      delegate_to: localhost
    - name: Deploy Pod Policy Group
      aci_rest:
        <<: *aci_login
        <<: *post_to_uni
        src: /home/nvermand/lab/fabric1/podpgrp-default.json
      delegate_to: localhost
    - name: Deploy Pod Profile
      aci_rest:
        <<: *aci_login
        <<: *post_to_uni
        src: /home/nvermand/lab/fabric1/podprof-default.json
      delegate_to: localhost
    - name: Deploy VLAN Pools
      aci_rest:
        <<: *aci_login
        <<: *post_to_uni
        src: "{{ item }}"
      delegate_to: localhost
      with_items: "{{ vlan_pool_list }}"
      async: 2
      poll: 1
    - name: Deploy Domains
      aci_rest:
        <<: *aci_login
        <<: *post_to_uni
        src: "{{ item }}"
      delegate_to: localhost
      with_items: "{{ domain_list }}"
    - name: Deploy VPC Protection Group Policy
      aci_rest:
        <<: *aci_login
        <<: *post_to_uni
        src: /home/nvermand/lab/fabric1/vpc-protpol.json
      delegate_to: localhost
    



